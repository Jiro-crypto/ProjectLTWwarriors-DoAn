@model ProjectLTWwarriors.Models.ViewModel.ProductSearchVm
@using PagedList.Mvc;

<head>
    <style>
        img {
            height: 150px;
            max-width: 200px;
            object-fit: cover;
        }

        .pagination-container {
            display: flex;
            justify-content: left;
            margin-top: 20px;
        }

            .pagination-container ul.pagination {
                display: inline-flex;
                padding: 10px 15px;
                border: 1px solid #ccc;
                border-radius: 6px;
                background-color: #f9f9f9;
            }

                .pagination-container ul.pagination li {
                    margin: 0 3px;
                }

                    .pagination-container ul.pagination li a,
                    .pagination-container ul.pagination li span {
                        border: none;
                        color: #333;
                        padding: 6px 12px;
                        text-decoration: none;
                    }

                    .pagination-container ul.pagination li.active span {
                        background-color: #007bff;
                        color: white;
                        border-radius: 4px;
                    }

                    .pagination-container ul.pagination li a:hover {
                        background-color: #ddd;
                        border-radius: 4px;
                    }
    </style>
</head>

@if (Model.Products != null && Model.Products.Any())
{
    <h2 class="bg-dark container-fluid text-secondary">Danh sách sản phẩm</h2>


    <table class="table bg-light container-fluid">
        <tr>
            <th class="bg-light col-md-2">
                Hình ảnh sản phẩm
            </th>
            <th class="bg-light col-md-3">
                Tên sản phẩm
            </th>

            <th class="bg-light col-md-2">Giá sản phẩm</th>

            <th class="bg-light col-md-2">Danh mục sản phẩm</th>
            <th class="bg-light col-md-4"></th>
        </tr>

        <tbody>
            @foreach (var product in Model.Products)
            {
                <tr>
                    <td>
                        @Html.DisplayFor(m => product.Name)
                    </td>

                    <td>
                        @{
                            // Lấy 1 tấm hình đại diện của sản phẩm
                            // lấy list ảnh từ ProductImages trong database
                            // Sau đó đánh dấu ảnh chính để ưu tiên ảnh đó
                            // FirstOrDefault() trong đây có tác dụng lấy 1 tấm làm thumbnail
                            var firstImage = product.ProductImages
                                                   .OrderByDescending(i => i.IsPrimary) // ưu tiên IsPrimary = true
                                                   .FirstOrDefault();
                        }

                        @if (firstImage != null && !string.IsNullOrEmpty(firstImage.ImageUrl))
                        {
                            <img src="@Url.Content(firstImage.ImageUrl)" />
                        }
                        else
                        {
                            <span>Không có hình</span>
                        }
                    </td>

                    @*Biến số Price thành chuỗi “đẹp mắt”, có dấu ngăn cách hàng nghìn và thêm ký hiệu đ.*@
                    <td>
                        @String.Format("{0:N0} đ", product.Price)
                    </td>

                    <td>
                        @(product.Categories != null ? product.Categories.Name : "—")
                    </td>

                    <td>
                        

                        @Html.ActionLink("Chỉnh sửa", "Edit", new { id = product.Id }, new { @class = "btn btn-dark btn-sm" })
                        @Html.ActionLink("Chi tiết", "Details", new { id = product.Id }, new { @class = "btn btn-dark btn-sm" })
                        @Html.ActionLink("Xóa", "Delete", new { id = product.Id }, new { @class = "btn btn-dark btn-sm" })
                    </td>
                </tr>
            }
        </tbody>
    </table>

    <div class="pagination-container">
        @Html.PagedListPager(
                 Model.Products,
                 page => Url.Action("Index", new
                 {
                     page,
                     searchTerm = Model.SearchTerm,
                     minPrice = Model.MinPrice,
                     maxPrice = Model.MaxPrice,
                     sortOrder = Model.SortOrder
                 })
             )
    </div>
}
else
{
    <p>Không tìm được sản phẩm nào phù hợp.</p>
}

<div class="form-group">
    <div class="col-md-offset-8 col-md-4">
        @Html.ActionLink("Thêm Sản Phẩm Mới", "Create", null, new { @class = "btn btn-dark" })
    </div>
</div>



